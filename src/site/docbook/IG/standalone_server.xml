<?xml version='1.0' encoding='UTF-8'?> 
<!--

    Copyright 2005-2012 The Kuali Foundation

    Licensed under the Educational Community License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.opensource.org/licenses/ecl2.php

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<chapter xml:id="standalone_server" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://docbook.org/ns/docbook"  version="5.0">    
    <title>Standalone Server Setup</title>
    <para>This chapter is designed to provide simple step-by-step instructions on how to set up a
        Kuali Rice standalone server intended for enterprise deployment.</para>
    <para>The steps to install and setup a standalone server with Kuali Rice are:</para>
    <para>First, <emphasis role="bold">set up the database server</emphasis>. Kuali Rice is
        typically deployed as a Standalone Server with the database server separate from the
        application server.Please refer to the <link linkend="database_setup">Installing and
            Configuring the Database Management System</link> section of this guide to install and
        configure your database on the database server.</para>
    <para>Next, set up your standalone Rice server with the following steps:<orderedlist>
            <listitem>
                <para>Determine your expected load and storage needs and consult the Suggested
                    Server Hardware section for guidance. Install OS.</para>
            </listitem>
            <listitem>
                <para><emphasis role="bold">Install &amp; configure required software</emphasis> -
                    Please refer to the <link linkend="common_setup">Common Setup</link> section of
                    this guide to install and configure software required by both development and
                    standalone server environments.</para>
            </listitem>
            <listitem>
                <para>Install and configure Tomcat.</para>
            </listitem>
            <listitem>
                <para>Install and Configure Rice.</para>
            </listitem>
            <listitem>
                <para>Launch the Sample Application.</para>
            </listitem>
            <listitem>
                <para>Set up a Keystore.</para>
            </listitem>
        </orderedlist>
    </para>
    <note><para>Rather than install and setup as the root user on systems designed for production, you may
            want to create a non-privilieged user named something like 'rice' to use for this
            purpose.</para></note>
    <section>
        <title>Suggested Server Hardware</title>
        <para>Note that hardware needs may vary depending on the amount of expected load, the
            operating system being used, and the number of applications that are integrated with
            Kuali Rice. Kuali Rice is typically deployed as a standalone server with the database
            server separate from the application server. </para>
        <para>The recommended minimum requirements are as follows:<itemizedlist>
            <listitem>
                <para>Processor 1.5 GHz or faster (2 GHz preferred)</para>
            </listitem>
            <listitem>
                <para>1024 MB (1 GB) of RAM or more</para>
            </listitem>
            <listitem>
                <para>100 Mbit/s network card (gigabit preferred)</para>
            </listitem>
            <listitem>
                <para>200 MB of hard disk space (for Tomcat server and web application)</para>
                    <note><para>Additional space needed if storing attachments.</para></note>
            </listitem>
        </itemizedlist></para>
        <para>See <link linkend="appendix_server_configs">Example Server Configurations</link> in
            the appendix for examples of hardware and software configurations of Kuali Rice
            servers.</para>
    </section>
    <section>
        <title>Install and Setup Apache Tomcat</title>
        <para>Kuali Rice ${project.version} supports the following Tomcat versions:<itemizedlist>
                <listitem>
                    <para>Tomcat 6 (Servlet API 2.5, JSP 2.1) </para>
                </listitem>
                <listitem>
                    <para>Tomcat 7 (Servlet API 3.0, JSP 2.2) </para>
                </listitem>
        </itemizedlist></para>
        <para>Please visit the <link xlink:href="http://tomcat.apache.org/">Apache Tomcat
                site</link> for information on how to install and configure Tomcat.</para>
        <para>Other servlet containers can be used with Kuali Rice, but this guide will focus on
            Tomcat.</para>
    </section>
    <section>
        <title>Setting Up the Rice Application</title>
        <section>
            <title>Install Rice from distribution</title>
            <para>The quickest way to get Rice installed on a standalone server is to download the
                    <emphasis role="bold">Standalone Server</emphasis> distribution from the <link
                    xlink:href="http://kuali.org/rice/download">kuali.org download site</link>. Once
                downloaded, uncompress the software.</para>
        </section>
        <section>
            <title>Deploying the WAR file</title>
            <para>
                <orderedlist>
                    <listitem>
                        <para>Copy the kr-dev.war file from the base directory of the server
                            distribution to the directory that contains web applications in your
                            servlet container. For Tomcat, this is <emphasis role="bold"
                                >[Tomcat-root-directory]/webapps</emphasis>.</para>
                    </listitem>
                    <listitem>
                        <para>Copy the database-specific JDBC driver to the
                        [Tomcat-root-directory]/common/lib. Examples:</para>
                        <itemizedlist>
                            <listitem>
                                <para>MySQL</para>
                                <para>
                                    <programlisting>cp -p /java/drivers/mysql-connector-java-5.1.5-bin.jar /usr/local/tomcat/common/lib</programlisting>
                                </para>
                            </listitem>
                            <listitem>
                                <para>Oracle</para>
                                <para>
                                    <programlisting>cp -p /java/drivers/ojdbc14.jar /usr/local/tomcat/common/lib</programlisting>
                                </para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                <listitem><para>Configure the rice-config.xml File. By default when it starts, Rice attempts to read the <emphasis role="bold"
                        >rice-config.xml</emphasis> configuration file from the paths in this order:<orderedlist>
                        <listitem>
                            <para>/usr/local/rice/rice-config.xml </para>
                        </listitem>
                        <listitem>
                            <para>${rice.base}../../../conf/rice-config.xml </para>
                        </listitem>
                        <listitem>
                            <para>${rice.base}../../conf/rice-config.xml </para>
                        </listitem>
                        <listitem>
                            <para>${additional.config.locations} </para>
                        </listitem>
                    </orderedlist></para>
                <para>The value for <emphasis role="bold">rice.base</emphasis> is calculated using
                    different locations until a valid location is found. Kuali calculates it using
                    these locations in this sequence:<orderedlist>
                        <listitem>
                            <para>ServletContext.getRealPath("/") </para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">catalina.base</emphasis> system property
                            </para>
                        </listitem>
                        <listitem>
                            <para>The current working directory</para>
                        </listitem>
                    </orderedlist></para>
                <para>An example <emphasis role="bold">rice-config.xml</emphasis> file is included
                            in the server distribution under <emphasis role="bold"
                                >web/src/main/config/example-config</emphasis>.</para>  
                <para>For MySQL, just modify the following database parameters in the <emphasis
                                role="bold">rice-config.xml</emphasis> file. The values should
                            conform to the values you will use with the ImpEx tool via the <emphasis
                                role="bold">impex-build.properties</emphasis> file. ImpEx is set up
                    in the <link linkend="database_setup">Installing and
                        Configuring the Database Management System</link> section of this guide. </para>
                    <para>
                        <programlisting>datasource.url=jdbc:mysql://localhost:3306/rice
datasource.username=rice
datasource.password=kualirice
datasource.url=jdbc:mysql://remoteMySQLServerComputerName:3306/rice
datasource.username=rice
datasource.password=kualirice</programlisting>
                    </para>
                    <para>If you are using Oracle, the JDBC URL will have this
                        general form:</para>
                    <para>
                        <programlisting>datasource.url=jdbc:oracle:thin:@remoteMySQLServerComputerName:1521:ORACLE_SID</programlisting>
                    </para>
                    <note><para>Additional configuration parameters are described in the <link linkend="database_setup">Parameters</link> section of this guide.</para></note>
                </listitem>
                <listitem>
                    <para>At this point, you are ready to try to bring up the Tomcat
                        server with the Rice web application:</para>
                    <para>
                        <programlisting>cd /usr/local/tomcat/bin
./startup.sh</programlisting>
                    </para>
                </listitem>
                <listitem>    
                    <para>Check if Tomcat and Rice started successfully:</para>
                    <para>
                        <programlisting>cd /usr/local/tomcat/logs
tail -n 500 -f catalina.out</programlisting>
                    </para>
                </listitem>
                <listitem>
                    <para>If your Rice server started up successfully, browse to the
                        site <emphasis role="bold"
                            >http://yourlocalip:8080/kr-dev</emphasis>. You should
                        see the Rice portal screen which will look something like
                        this: </para>
                    <figure>
                        <title>Rice Portal Main Menu</title>
                        <mediaobject>
                            <imageobject>
                                <imagedata
                                    fileref="../images/rice_portal_main_menu.png"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
            </listitem></orderedlist>
            </para>
            </section>
             <section xml:id="rice_config_parameters"> 
                    <title>Parameters</title>
                <para>The tables below have the basic set of parameters for <emphasis role="bold"
                    >rice-config.xml</emphasis> that you need to get an instance of Rice running.
                Please use these tables as a beginning reference to modify your <emphasis
                    role="bold">rice-config.xml</emphasis> file. </para>
                <warning>
                    <para>Make sure the <emphasis role="bold">application.url</emphasis> and
                        database user name and password are set correctly.</para>
                </warning>  
                <table frame="none">
                    <title>Core </title>
                    <tgroup cols="3">
                        <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                        <colspec colname="c2" colnum="2" colwidth="1.56*"/>
                        <colspec colname="c3" colnum="3" colwidth="1.39*"/>
                        <thead>
                            <row>
                                <entry>Parameter</entry>
                                <entry>Description</entry>
                                <entry>Examples or Values</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>application.url </entry>
                                <entry>The external URL used to access the Rice web
                                    interface; edit only the fully-qualified domain name and
                                    port of the server </entry>
                                <entry>http://yourlocalip:8080/kuali-rice-url</entry>
                            </row>
                            <row>
                                <entry>app.context.name</entry>
                                <entry><para>Context name of the web application</para>
                                    <itemizedlist>
                                        <listitem>
                                          <para>Essentially, the name of the WAR file</para>
                                        </listitem>
                                        <listitem>
                                          <para>Used to build the path for images and help
                                          URLs</para>
                                        </listitem>
                                    </itemizedlist></entry>
                                <entry>kuali-rice-url
                                    (This value should not be changed)
                                </entry>
                            </row>
                            <row>
                                <entry>log4j.settings.path </entry>
                                <entry>Path to log4j.properties file. If the file does not
                                    exist, you must create it.</entry>
                                <entry>/usr/local/rice/log4j.properties</entry>
                            </row>
                            <row>
                                <entry>log4j.settings.reloadInterval</entry>
                                <entry>interval (in minutes) to check for changes to the
                                    log4j.properties file</entry>
                                <entry>5</entry>
                            </row>
                            <row>
                                <entry>mail.smtp.host</entry>
                                <entry>SMTP host name or IP (This param is not in the
                                    default config.) </entry>
                                <entry>localhost</entry>
                            </row>
                            <row>
                                <entry>config.location</entry>
                                <entry>Location of configuration file to load
                                    environment-specific configuration parameters (This
                                    param is not in the default config.) </entry>
                                <entry>/usr/local/rice/rice-config-${environment}.xml</entry>
                            </row>
                            <row>
                                <entry>sample.enabled</entry>
                                <entry>Enable the sample application</entry>
                                <entry>boolean</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            <table frame="none">
                <title>Database</title>
                <tgroup cols="3">
                    <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                    <colspec colname="c2" colnum="2" colwidth="1.55*"/>
                    <colspec colname="c3" colnum="3" colwidth="2.34*"/>
                    <thead>
                        <row>
                            <entry>Parameter</entry>
                            <entry>Description</entry>
                            <entry>Examples or Values</entry>
                        </row>
                    </thead>
                    <tbody>
                            <row>
                                <entry>datasource.ojb.platform </entry>
                                <entry>Name of OJB platform to use for the database </entry>
                                <entry>Oracle9i or MySQL</entry>
                            </row>
                            <row>
                                <entry>datasource.platform </entry>
                                <entry>Rice platform implementation for the database </entry>
                                <entry>
                                    <itemizedlist>
                                        <listitem>
                                          <para>org.kuali.rice.core.database.platform.DerbyPlatform</para>
                                        </listitem>
                                        <listitem>
                                          <para>org.kuali.rice.core.database.platform.OraclePlatform</para>
                                        </listitem>
                                        <listitem>
                                          <para>org.kuali.rice.core.database.platform.MySQLPlatform
                                          </para>
                                        </listitem>
                                    </itemizedlist>
                                </entry>
                            </row>
                            <row>
                                <entry>datasource.driver.name </entry>
                                <entry>JDBC driver for the database </entry>
                                <entry>
                                    <itemizedlist>
                                        <listitem>
                                          <para>org.apache.derby.jdbc.EmbeddedDriver,</para>
                                        </listitem>
                                        <listitem>
                                          <para>oracle.jdbc.driver.OracleDriver</para>
                                        </listitem>
                                        <listitem>
                                          <para>com.mysql.jdbc.Driver </para>
                                        </listitem>
                                    </itemizedlist>
                                </entry>
                            </row>
                            <row>
                                <entry>datasource.username </entry>
                                <entry>User name for connecting to the server database </entry>
                                <entry>rice</entry>
                            </row>
                            <row>
                                <entry>datasource.password </entry>
                                <entry>Password for connecting to the server database </entry>
                                <entry/>
                            </row>
                            <row>
                                <entry>datasource.url </entry>
                                <entry>JDBC URL of database to connect to </entry>
                                <entry>
                                    <itemizedlist>
                                        <listitem>
                                            <para>jdbc:oracle:thin:@localhost:1521:XE</para>
                                        </listitem>
                                        <listitem>
                                            <para>jdbc:mysql://localhost:3306/kuldemo </para>
                                        </listitem>
                                    </itemizedlist>
                                </entry>
                            </row>
                            <row>
                                <entry>datasource.pool.minSize </entry>
                                <entry>Minimum number of connections to hold in the pool </entry>
                                <entry>an integer value suitable for your environment</entry>
                            </row>
                            <row>
                                <entry>datasource.pool.maxSize </entry>
                                <entry>Maximum number of connections to allocate in the pool </entry>
                                <entry>an integer value suitable for your environment</entry>
                            </row>
                            <row>
                                <entry>datasource.pool.maxWait </entry>
                                <entry>Maximum amount of time (in ms) to wait for a connection from
                                    the pool </entry>
                                <entry>10000</entry>
                            </row>
                            <row>
                                <entry>datasource.pool.validationQuery </entry>
                                <entry>Query to validate connections from the database </entry>
                                <entry>select 1 from dual</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <table frame="none">
                    <title>KSB</title>
                    <tgroup cols="3">
                        <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                        <colspec colname="c2" colnum="2" colwidth="1.55*"/>
                        <colspec colname="c3" colnum="3" colwidth="2.34*"/>
                        <thead>
                            <row>
                                <entry>Parameter</entry>
                                <entry>Description</entry>
                                <entry>Examples or Values</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>serviceServletUrl </entry>
                                <entry>URL that maps to the KSBDispatcherServlet (include a trailing
                                    slash); This param is not in the default config. </entry>
                                <entry></entry>
                            </row>
                            <row>
                                <entry>keystore.file </entry>
                                <entry>Path to the keystore file to use for security </entry>
                                <entry>/usr/local/rice/rice.keystore</entry>
                            </row>
                            <row>
                                <entry>keystore.alias </entry>
                                <entry>Alias of the standalone server's key </entry>
                                <entry>see section entitled Generating the Keystore</entry>
                            </row>
                            <row>
                                <entry>keystore.password </entry>
                                <entry>Password to access the keystore and the server's key </entry>
                                <entry>see section entitled Generating the Keystore</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table> 
                <table frame="none">
                    <title>KEN</title>
                    <tgroup cols="3">
                        <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                        <colspec colname="c2" colnum="2" colwidth="1.55*"/>
                        <colspec colname="c3" colnum="3" colwidth="2.34*"/>
                        <thead>
                            <row>
                                <entry>Parameter</entry>
                                <entry>Description</entry>
                                <entry>Examples or Values</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>notification.basewebappurl </entry>
                                <entry>Base URL of the KEN web application (This param is not in the
                                    default config.) </entry>
                                <entry></entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table> 
                <table frame="none">
                    <title>KEW</title>
                    <tgroup cols="3">
                        <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                        <colspec colname="c2" colnum="2" colwidth="1.55*"/>
                        <colspec colname="c3" colnum="3" colwidth="2.34*"/>
                        <thead>
                            <row>
                                <entry>Parameter</entry>
                                <entry>Description</entry>
                                <entry>Examples or Values</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>workflow.url </entry>
                                <entry>URL to the KEW web module</entry>
                                <entry>${application.url}/kew</entry>
                            </row>
                            <row>
                                <entry>plugin.dir </entry>
                                <entry>Directory from which plugins will be loaded </entry>
                                <entry>/usr/local/rice/plugins</entry>
                            </row>
                            <row>
                                <entry>attachment.dir.location </entry>
                                <entry>Directory where attachments will be stored (This param is not
                                    in the default config.) </entry>
                                <entry/>
                            </row>
                        </tbody>
                    </tgroup>
                </table>   
              </section>     
            </section>
    <section xml:id="keystore">
        <title>Setup a Keystore</title>
        <para>For client applications to consume secured services hosted from a Rice server, you
            must generate a keystore. As an initial setup, you can use the keystore provided by
            Rice. Once a keystore is generated, you must configure the KSB to use the
            keystore.</para>
        <section>
            <title>Generating a Keystore</title>
            <para>There are three ways to get this keystore:<orderedlist>
                <listitem>
                    <para>If you are doing a source code build of Rice, it is in the directory <emphasis
                        role="bold">&lt;source root>/security</emphasis> and it has a file name of
                        <emphasis role="bold">rice.keystore</emphasis></para>
                </listitem>
                <listitem>
                    <para>The keystore is also located in the server distribution under the security
                        directory. </para>
                </listitem>
                <listitem>
                    <para>You can generate the keystore yourself. Please refer to the <link xlink:href="TRG.html#security_and_keystores">Security and Keystores</link> 
                        section in the <link xlink:href="TRG.html#TRG_KSB">KSB chapter</link> of the <link xlink:href="TRG.html">Technical Reference Guide</link> for the
                        steps to accomplish this.</para>
                </listitem>
            </orderedlist></para>
        </section>
        <section>
            <title>Configure KSB to use the keystore</title>
            <para>You must have these params in the xml config to allow KSB to use the keystore:</para>
            <para>
                <programlisting>&lt;param name="keystore.file">/usr/local/rice/rice.keystore&lt;/param>
&lt;param name="keystore.alias">rice&lt;/param>
&lt;param name="keystore.password">r1c3pw&lt;/param>            </programlisting>
            </para>    
            <itemizedlist>
                <listitem>
                    <para>keystore.file - The location of the keystore</para>
                </listitem>
                <listitem>
                    <para>keystore.alias - The alias used in creating the keystore above</para>
                </listitem>
                <listitem>
                    <para>keystore.password - This is the password of the alias AND the keystore. This
                        assumes that the keystore is set up so that these are the same. </para>
                </listitem>
            </itemizedlist>
        </section>
    </section>
</chapter>

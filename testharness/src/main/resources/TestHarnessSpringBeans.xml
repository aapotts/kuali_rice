<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!-- The workflow engine Spring configuration is bifurcated into data source and bean configuration
     to allow independent replacement of the data source configuration (for example for unit tests) -->
<beans>
  <!-- This PropertyPlaceholderConfigurer subclass automagically takes properties from the workflow Config system -->
  <bean class="org.kuali.rice.config.spring.ConfigPropertyPlaceholderConfigurer" />

  <bean id="ojbConfigurer" class="org.kuali.rice.ojb.JtaOjbConfigurer">
    <property name="transactionManager" ref="jtaTransactionManager"/>
  </bean>

  <bean id="jotm" class="org.springframework.transaction.jta.JotmFactoryBean" depends-on="ojbConfigurer"/>

  <bean id="userTransaction" class="org.kuali.rice.jta.UserTransactionFactoryBean">
  	<property name="defaultUserTransaction"><ref local="jotm"/></property>
  </bean>
  <bean id="jtaTransactionManager" class="org.kuali.rice.jta.TransactionManagerFactoryBean">
  	<property name="defaultTransactionManager"><ref local="jotm"/></property>
  </bean>

  <bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager" depends-on="jotm">
    <property name="userTransaction"><ref local="userTransaction"/></property>
    <property name="transactionManager"><ref local="jtaTransactionManager"/></property>
  </bean>

	<bean id="transactionTemplate" class="org.springframework.transaction.support.TransactionTemplate">
		<property name="transactionManager">
			<ref bean="transactionManager" />
		</property>
	</bean>

  <bean id="dataSource" class="org.kuali.rice.database.XAPoolDataSource" init-method="start" destroy-method="stop">
    <property name="transactionManager"><ref local="jtaTransactionManager"/></property>
    <property name="driverClassName"><value>${datasource.driver.name}</value></property>
    <property name="url"><value>${datasource.url}</value></property>
    <property name="maxSize"><value>${datasource.pool.maxSize}</value></property>
    <property name="minSize"><value>${datasource.pool.minSize}</value></property>
    <property name="maxWait"><value>${datasource.pool.maxWait}</value></property>
    <property name="validationQuery"><value>${datasource.pool.validationQuery}</value></property>
    <property name="username"><value>${datasource.username}</value></property>
    <property name="password"><value>${datasource.password}</value></property>
  </bean>

</beans>
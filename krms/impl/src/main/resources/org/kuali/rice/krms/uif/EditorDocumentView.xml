<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans         
                           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                           http://www.springframework.org/schema/util 
                           http://www.springframework.org/schema/util/spring-util-3.0.xsd">       
  <!--
   Copyright 2007-2009 The Kuali Foundation

   Licensed under the Educational Community License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

   http://www.opensource.org/licenses/ecl2.php

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
  -->


  <bean id="EditorMaintenanceDocument" parent="MaintenanceDocumentEntry">
    <property name="businessObjectClass" value="org.kuali.rice.krms.impl.ui.EditorDocument"/>
    <property name="maintainableClass" value="org.kuali.rice.krms.impl.ui.EditorDocumentMaintainable"/>
    <property name="documentTypeName" value="EditorMaintenanceDocument"/>
    <property name="documentAuthorizerClass"
              value="org.kuali.rice.kns.document.authorization.MaintenanceDocumentAuthorizerBase"/>
    <property name="lockingKeys">
      <list>
        <value>agenda.id</value>
      </list>
    </property>
  </bean>

  <!-- hack to merge a list with one of those util:lists -->
  <bean id="krms-css" class="org.apache.commons.collections.ListUtils" factory-method="union">
      <constructor-arg>
          <ref bean="kns-css" />
      </constructor-arg> 
      <constructor-arg><list><value>/krms/css/agendaTree.css</value></list></constructor-arg>
  </bean>

  <bean id="AgendaTreeWidget" parent="TreeWidget">
    <property name="template" value="/krad/WEB-INF/jsp/templates/widget/agendaTree.jsp"/>
  </bean>

  <bean id="Editor-MaintenanceView" parent="MaintenanceView">
    <property name="additionalCssFiles" ref="krms-css" /> 
    <property name="title" value="Business Rules"/>
    <property name="dataObjectClassName" value="org.kuali.rice.krms.impl.ui.EditorDocument"/>
    <property name="items">
      <list merge="true">
        <bean parent="GroupSection" p:accordion.render="false">
          <property name="items">
            <list>
              <bean parent="FieldGroup" p:label="Field Group 4">
                <!-- p:width="40%" p:labelField.width="10%" -->
                <property name="group.layoutManager.orientation" value="HORIZONTAL"/>
                <property name="items">
                  <list>
                    <bean parent="AttributeField" p:propertyName="context.name" p:labelPlacement="LEFT">
                      <!--  property name="required" value="true" / -->
                      <property name="control">
                        <bean parent="TextControl" p:size="30" p:watermarkText="name"/>
                      </property>
                      <property name="fieldLookup.dataObjectClassName"
                                value="org.kuali.rice.krms.impl.repository.ContextBo"/>
                      <property name="fieldLookup.fieldConversions">
                        <map>
                          <entry key="name" value="document.newMaintainableObject.dataObject.context.name"/>
                          <entry key="namespace" value="document.newMaintainableObject.dataObject.context.namespace"/>
                        </map>
                      </property>
                      <property name="label" value="Name"/>
                    </bean>
                    <bean parent="AttributeField" p:propertyName="context.namespace"
                          p:label="Namespace" p:labelPlacement="LEFT">
                      <property name="control">
                        <bean parent="TextControl" p:size="30" p:watermarkText="namespace"/>
                      </property>
                    </bean>
                  </list>
                </property>
              </bean>
            </list>

          </property>
          <property name="title" value="Context"/>
        </bean>

        <bean parent="GroupSection" >
          <property name="title" value="Agenda Editor II"/>
          <property name="items">
            <list>
              <bean parent="GroupGridBodyOnly" p:layoutManager.numberOfColumns="4" >
                <property name="items">
                  <list >
                    <ref bean="agendaName"/>
                    <ref bean="agendaActive"/>
                    
                    <bean parent="MessageField" p:messageText="Nodes:"/>
                    <bean parent="MessageField" p:messageText="- collapse all  + expand all  [ refresh ]"/>
                    <bean parent="MessageField" p:messageText="New Node(s):"/>
                    <bean parent="MessageField" p:messageText="[ add rules ]  [ O- ]"/>
                  </list>
                </property>
              </bean>
              
              <bean parent="GroupBodyOnly" p:style="border: 1px solid red; padding: 5px; margin: 5px; background: white; ">
                <property name="items">
                  <list>
                    <bean parent="GroupBodyOnly" p:style="margin-bottom: 15pt;">
                      <property name="items">
                        <list>
                          <bean parent="FieldGroup" p:showLabel="false" p:group.layoutManager.orientation="HORIZONTAL">
                            <property name="items">
                              <list>
                                <bean parent="ActionField" p:methodToCall="addWhenTrue" p:actionLabel="+ When TRUE" p:style="padding: 1pt;"/>
                                <bean parent="ActionField" p:methodToCall="addWhenFalse" p:actionLabel="+ When FALSE" p:style="padding: 1pt;"/>
                                <bean parent="ActionField" p:methodToCall="addNext" p:actionLabel="+ Next" p:style="margin-right: 15pt; padding: 1pt;"/>
                                <bean parent="ActionField" p:methodToCall="moveUp" p:actionLabel="Move Up" p:style="padding: 1pt;"/>
                                <bean parent="ActionField" p:methodToCall="moveDown" p:actionLabel="Move Down" p:style="margin-right: 15pt; padding: 1pt;"/>
                                <bean parent="ActionField" p:methodToCall="delete" p:actionLabel="Delete" p:style="padding: 1pt;"/>
                              </list> 
                            </property> 
                          </bean>
                        </list>
                      </property>
                    </bean>                  
                    <ref bean="tree" />
                  </list>
                </property>
              </bean>


            </list>
          </property>
        </bean>
        
      </list>
    </property>
  </bean>
  
  <bean id="agendaName" parent="FieldGroup" p:label="Name" p:colSpan="3" p:labelField.colSpan="1"
        p:group.layoutManager.orientation="HORIZONTAL">
    <property name="items">
      <list>
        <bean parent="AttributeField" p:propertyName="agenda.name" p:maxLength="29"
              p:labelField.render="false">
          <property name="control">
            <bean parent="TextControl" p:size="30" p:watermarkText="agenda name"/>
          </property>
          <property name="fieldLookup.dataObjectClassName"
                    value="org.kuali.rice.krms.impl.repository.AgendaBo"/>
          <property name="fieldLookup.lookupParameters">
            <map>
              <!-- TODO: this is not correct / working -->
              <entry key="criteriaFields['contextId']" value="document.newMaintainableObject.dataObject.context.id"/>
            </map>
          </property>
          <property name="fieldLookup.fieldConversions">
            <map>
              <entry key="name" value="document.newMaintainableObject.dataObject.agenda.name"/>
              <entry key="active" value="document.newMaintainableObject.dataObject.agenda.active"/>
            </map>
          </property>                                
        </bean>
        <bean parent="ActionField_Small" p:methodToCall="saveAgenda"
              p:actionLabel="save"/>
      </list>
    </property>
  </bean>

  <bean id="agendaActive" parent="AttributeField" p:propertyName="agenda.active"
        p:label="Active" p:colSpan="3" p:labelField.colSpan="1" p:maxLength="29">
    <property name="control">
      <bean parent="CheckboxControl"/>
    </property>
  </bean>
              
  <bean id="tree" parent="TreeGroup" p:accordion.render="false" p:header.render="false" p:style="float:left;">
    <property name="title" value="Agenda Items"/>
    <property name="propertyName" value="agendaRuleTree"/>
    <property name="treeWidget">
      <bean parent="AgendaTreeWidget">
        <property name="componentOptions">
          <map>
            <entry key="'plugins'"
              value="['themes','html_data', 'ui', 'crrm', 'dnd']" />
            <entry key="'themes'"
              value="{'theme':'default','dots':'false','icons':'false'}" />
            <entry key="'ui'" value="{ 'select_limit' : 1 }" />
            <entry key="'dnd'" value="{ 'drag_target' : false, 'drop_target' : false }" />
            <!-- entry key="'crrm'" value="
            {
            'move' : {
                   /*
                    * m.o - the node being dragged
                    * m.r - the target node
                    */
                    'check_move' : function (m) { 
                        var p = this._get_parent(m.o);
                        if(!p) return false;
                        p = p == -1 ? this.get_container() : p;
                        
                        if (m.o.hasClass('logicNode')) return false;
                        
                        if(p === m.np) return true;
                        if(p[0] &amp;&amp; m.np[0] &amp;&amp; p[0] === m.np[0]) return true;
                        return false;
                    }
                }
            } 
              "/ -->
          </map>
        </property>
      </bean>
    </property>
    <property name="nodeProtypeMap">
      <map key-type="java.lang.Class">
        <entry>
          <key>
            <bean class="java.lang.Class" factory-method="forName">
              <constructor-arg value="org.kuali.rice.krms.impl.ui.AgendaTreeRuleNode"/>
            </bean>
          </key> 
          <bean class="org.kuali.rice.kns.uif.container.TreeGroup.NodePrototype">
            <property name="labelPrototype">
              <bean parent="MessageField"/>
            </property>
            <property name="dataGroupPrototype">
              <bean parent="GroupBodyOnly">
              <!-- trying out having the buttons above the tree instead of them being part of each node -->
              <!-- 
                <property name="items">
                  <list>
                    <bean parent="GroupGridBodyOnly" p:style="padding-left: 20px;">
                      <property name="items">
                        <list>
                          <bean parent="FieldGroup" p:label="Node" p:group.layoutManager.orientation="HORIZONTAL">
                            <property name="items">
                              <list>
                                <bean parent="ActionField" p:methodToCall="remove" p:actionLabel="remove node"/>
                                <bean parent="ActionField" p:methodToCall="cut" p:actionLabel="cut node"/>
                                <bean parent="ActionField" p:methodToCall="copy" p:actionLabel="copy node"/>
                                <bean parent="ActionField" p:methodToCall="paste" p:actionLabel="paste node"/>
                              </list>
                            </property>
                          </bean>
                        </list>
                      </property>
                      <property name="header.render" value="false"/>
                      <property name="accordion.render" value="false"/>
                    </bean>
                  </list>
                </property>
              -->
              </bean>
            </property>
          </bean>
        </entry>
        <entry>
          <key>
            <bean class="java.lang.Class" factory-method="forName">
              <constructor-arg value="org.kuali.rice.krms.impl.ui.AgendaTreeLogicNode"/>
            </bean>
          </key> 
          <bean class="org.kuali.rice.kns.uif.container.TreeGroup.NodePrototype">
            <property name="labelPrototype">
              <bean parent="MessageField"/>
            </property>
            <property name="dataGroupPrototype">
              <bean parent="GroupBodyOnly" />
            </property>
          </bean>
        </entry>
      </map>
    </property>
  </bean>

</beans>